<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>Spider Tools</title>

    <!-- PWA manifest + icons -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app" role="application">
        <header>
            <!-- Floating info button aligned to top-left -->
            <button id="infoBtn" class="floating-info-btn" aria-label="About Spider Tools">?</button>
            <img src="logo.png" alt="Ei Logo" id="homeLogo" class="logo">
        </header>

        <!-- Update banner (version checker) -->
        <div id="updateBanner" class="update-banner hidden" role="status" aria-live="polite">
            <span>New version available.</span>
            <button id="updateNowBtn" class="banner-btn">Update</button>
        </div>

        <!-- Install banner (add to home screen) -->
        <div id="installBanner" class="install-banner hidden" role="status" aria-live="polite">
            <span>Install Spider Tools on this device?</span>
            <div class="install-actions">
                <button id="installNowBtn" class="banner-btn">Install</button>
                <button id="installDismissBtn" class="banner-btn btn-secondary">Not now</button>
            </div>
        </div>

        <main>
            <section
                id="content"
                class="frame"
                role="region"
                aria-live="polite"
                aria-atomic="true">
            </section>
        </main>

        <nav class="tabs" role="tablist" aria-label="Primary navigation">
            <button class="tabbtn" role="tab" data-target="fails" aria-selected="false">
                üß™ Fails
            </button>
            <button class="tabbtn" role="tab" data-target="calculators" aria-selected="false">
                üßÆ Calculators
            </button>
        </nav>
    </div>

    <!-- Fails Screen Template -->
    <template id="tpl-fails">
        <div style="width:100%">
            <h2>Fails</h2>
            <p class="muted">
                Pick a Model ‚Üí Tester ‚Üí Fail<br>
                or use Model ‚Üí Search for quick lookup
            </p>

            <div class="row" style="width:min(480px,100%);text-align:left;">
                <label>
                    Model
                    <select id="modelSelect"></select>
                </label>

                <!-- Visually replaced by tester buttons, but kept for accessibility -->
                <label class="visually-hidden">
                    Tester
                    <select id="testerSelect" disabled>
                        <option value="" selected disabled>Select a tester</option>
                    </select>
                </label>

                <div id="testerButtons" class="tester-buttons" role="tablist" aria-label="Testers"></div>

                <label>
                    Fail
                    <select id="failSelect" disabled>
                        <option value="" selected disabled>Select a fail</option>
                    </select>
                </label>

                <div id="failExplanation" class="muted">
                    Choose a fail to see an explanation.
                </div>

                <div id="failSearchArea" class="fail-search hidden">
                    <h3 class="muted">Search fails</h3>
                    <input
                        id="failSearchInput"
                        type="text"
                        placeholder="Type to search..."
                        autocomplete="off">
                    <div id="failSearchResults"></div>
                </div>
            </div>
        </div>
    </template>

    <!-- Calculators Screen Template -->
    <template id="tpl-calculators">
        <div>
            <h2>Calculators</h2>
            <p class="muted">
                Select a <strong>model</strong>. For custom numbers, choose <strong>CUSTOM</strong>.
            </p>

            <div class="row" style="width:min(500px,100%);text-align:left;">
                <label>
                    Model
                    <select id="calcModel"></select>
                </label>

                <div id="modelSummary" class="muted"></div>

                <div class="mini-tabs" role="tablist" aria-label="Calculators">
                    <button class="tabbtn" role="tab" data-calc="pallet" aria-selected="true">
                        Pallet Count
                    </button>
                    <button class="tabbtn" role="tab" data-calc="eod" aria-selected="false">
                        End of Day
                    </button>
                </div>

                <div id="calcForm"></div>

                <div class="btnrow">
                    <button
                        id="calcGo"
                        class="tabbtn"
                        style="text-transform:none;font-size:16px;">
                        Calculate
                    </button>
                </div>

                <div id="calcResult" class="muted">Result will appear here.</div>
            </div>
        </div>
    </template>

    <!-- About Modal -->
    <div id="aboutModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="aboutTitle">
        <div class="modal-content">
            <h2 id="aboutTitle">About Spider Tools</h2>
            <p class="muted">
                A lightweight offline tool to support Spiders on the production line.
            </p>

            <h3>Features</h3>
            <ul>
                <li>Fail lookup (Model ‚Üí Tester ‚Üí Fail)</li>
                <li>Pallet + End-of-Day calculators</li>
                <li>Offline PWA support</li>
                <li>Custom data via <code>fails-data.json</code> and <code>calculator-data.json</code></li>
            </ul>

            <h3>Build Info</h3>
            <ul class="about-meta">
                <li>App version: <span id="aboutAppVersion">-</span></li>
                <li>Fails data: <span id="aboutFailsVersion">-</span></li>
                <li>Calculator data: <span id="aboutCalcVersion">-</span></li>
            </ul>

            <h3>Install</h3>
            <p class="muted" id="iosInstallHint">
                On iOS: use the Share button and choose <strong>Add to Home Screen</strong>.
            </p>

            <p class="muted" style="margin-top:15px;font-size:12px;">
                Works offline ‚Ä¢ Made for Spiders üï∑Ô∏è
            </p>

            <button id="closeAbout" class="tabbtn" style="margin-top:15px;">Close</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
